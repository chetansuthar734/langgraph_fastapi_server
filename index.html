

<!DOCTYPE html>
<html>
<head>
    <title>LANG-APP</title>
     <style>
        body {
            margin: 0;
            padding-bottom: 60px; /* space for input bar */
            font-family: Arial, sans-serif;
        }
        #inp {
    position: fixed;
    height: auto;
    bottom: 20px;
    left: 20px;
    right: 20px;
    background-color: #ffffff; /* White box for better contrast */
    padding: 20px;
    display: flex;
    gap: 10px;
    border-radius: 20px;

    /* Stronger outer shadow */
    box-shadow: 0 8px 20px rgba(21, 19, 19, 0.896);

    z-index: 999;
}     

#navigator {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background-color: #1f2937; /* dark gray-blue */
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            z-index: 1000;
        }

        #nav-title {
            font-size: 20px;
            font-weight: bold;
        }

        .nav-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .nav-item {
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 8px;
            background-color: rgba(255, 255, 255, 0.1);
        }

        .nav-item:hover {
            background-color: rgba(15, 118, 202, 0.776);
        }

        #messageInput {
            flex: 1;
            padding: 8px;
            font-size: 16px;
        }

        button {
            padding: 8px 16px;
            font-size: 16px;
            cursor: pointer;
        }

         /* Events/chat container */
#events {
    padding: 80px 10px 120px;
    display: flex;
    flex-direction: column;
    gap: 12px;
    max-width: 100%;
    box-sizing: border-box;
    overflow-x: hidden;
}

.message {
    max-width: 80%;
    word-wrap: break-word;
    overflow-wrap: break-word;
    white-space: pre-wrap;
    box-sizing: border-box;
}

       .user-message {
    align-self: flex-end;
    background-color: #dcfce7;
    max-width: 80%;
    width: fit-content;     /* ensures the box wraps the message nicely */
    text-align: right;   
    padding: 20px;   /* optional: aligns the text inside bubble */
    border-radius: 20px;
}

.bot-message {
    align-self: flex-start;
    background-color: #e5e7eb;
    max-width: 80%;
    width: fit-content; /* ensures it shrinks to content */
    padding: 20px;   /* optional: aligns the text inside bubble */
    text-align: left;    /* optional: aligns text inside */
    border-radius: 20px;
}

#messageInput{
    border-width: 0px ;
}
#messageInput:focus{

outline: none;

} 
    </style>

</head>
<body>
    <div id="navigator">
        <div id="nav-title">LangGraph ChatApp</div>
        <div class="nav-section">
            <div class="nav-item" onclick="alert('Settings clicked')">‚öôÔ∏è LLM Temperature</div>
            <div class="nav-item" id="agent-status">üü¢ Agent: Active</div>
        </div>
    </div>


    <div id ='inp'>
        <input type="text" id="messageInput" placeholder="üòé Enter message to chatbot ü§ñ" />
        <button onclick="startSSE()" style="border-radius: 10px;"><img >search</button>
    </div>

    <div id="events"></div>
<script>
    let eventSource;
    let checkpoint_id = null;
    let botBubble = null; // Reference to current bot message

    function addMessage(text, isUser = false) {
        const container = document.getElementById("events");
        const msg = document.createElement("div");
        msg.className = `message ${isUser ? 'user-message' : 'bot-message'}`;


        msg.textContent =  `${isUser ? 'üòé. ' : 'ü§ñ. '}`  + text;
        container.appendChild(msg);
        container.scrollTop = container.scrollHeight;
//    msg.scrollIntoView({ behavior: 'smooth', block: 'end' });
        // Return the message div (useful for bot message reference)
        return msg;
    }

    function startSSE() {
        const input = document.getElementById("messageInput").value.trim();
        const container = document.getElementById("events");

        if (!input) {
            alert("Please enter a message.");
            return;
        }

        // Show user message
        addMessage(input, true);
        document.getElementById("messageInput").value = "";

        // Close existing SSE connection
        if (eventSource) {
            eventSource.close();
            console.log("Closed previous SSE connection.");
        }

        // Start new SSE request
        const url = `http://127.0.0.1:8000/chat_stream/${encodeURIComponent(input)}${checkpoint_id ? `?checkpoint_id=${checkpoint_id}` : ''}`;
        eventSource = new EventSource(url);

        botBubble = null; // Reset for new bot message

        eventSource.onopen = function () {
            console.log("SSE connection opened.");
            document.getElementById("agent-status").textContent = "üü¢ Agent: Responding...";
        };

        eventSource.onmessage = function (event) {
            const parsed = JSON.parse(event.data);

            if (parsed.type === "checkpoint") {
                checkpoint_id = parsed.checkpoint_id;
            }
            else if (parsed.type === "content") {
                if (!botBubble) {
                    // Create one bot bubble when first chunk arrives
                    botBubble = addMessage(parsed.content, false);
                } else {
                    // Append to existing bot bubble
                    botBubble.textContent += parsed.content;
                    
                }

        // ‚úÖ Always scroll to bottom after updating content
        botBubble.scrollIntoView({ behavior: 'smooth', block: 'end' });
            }
            else if (parsed.type === "end") {
                eventSource.close();
                document.getElementById("agent-status").textContent = "‚úÖ Agent: Idle";
                botBubble = null; // Reset for next message
                
            }
        };

        eventSource.onerror = function (err) {
            console.error("SSE error:", err);
            eventSource.close();
            document.getElementById("agent-status").textContent = "üî¥ Agent: Disconnected";
        };
    }
</script>

</body>
</html>